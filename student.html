<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>DocuMint | Terminal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; overflow-x: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .hidden { display: none; }
        .custom-scroll::-webkit-scrollbar { width: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .sidebar-expanded { width: 260px; }

        /* --- PRINT STYLES: CRITICAL FIX FOR SINGLE PAGE --- */
        @media print {
            /* 1. Reset margins to use full paper area */
            @page { 
                size: Letter; 
                margin: 10mm !important; /* Standard margin */
            } 

            /* 2. Hide the main application UI when printing */
            body.printing > * {
                display: none !important;
            }

            /* 3. Show only the print container and remove all screen formatting */
            body.printing #print-container {
                display: block !important;
                visibility: visible !important;
                position: static !important;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
                color: #1e293b;
            }

            /* New layout for the single receipt on the page */
            .print-page-layout {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center; /* Center the receipt on the page */
                justify-content: flex-start;
                font-size: 11px; /* Base print font size */
            }

            /* Style for the single receipt copy - clear and minimal */
            .receipt-copy {
                width: 100%; 
                max-width: 190mm; /* Maximize width on paper */
                border: 1px solid #1e293b; 
                padding: 15px; /* Comfortable padding for reading */
                page-break-inside: avoid; 
                box-sizing: border-box;
                background-color: white;
                box-shadow: none !important;
                border-radius: 0 !important;
            }
            
            /* Overrides for compactness */
            .receipt-copy .text-lg { font-size: 16px; }
            .receipt-copy .text-xs { font-size: 11px; }
            .receipt-copy .text- { font-size: 10px; }
            /* Ensure print quality */
            .receipt-copy h4 { color: #1e293b !important; }
            .receipt-copy p { color: #334155 !important; }

            /* Reduce vertical spacing within the receipt */
            .receipt-copy .space-y-3 > div, 
            .receipt-copy .space-y-1 > div {
                padding-top: 2px;
                padding-bottom: 2px;
            }
            .receipt-copy .mb-10 {
                margin-bottom: 8px !important; 
            }
            .receipt-copy img {
                /* Ensure logo is printed clearly */
                filter: none; 
            }
        }

    </style>
</head>

<body class="text-slate-800">

    <div class="min-h-screen flex">
        
        <!-- SIDEBAR (Not shown when printing) -->
        <aside id="sidebar" class="sidebar-expanded bg-white border-r border-slate-200 flex flex-col transition-all duration-300 z-30 sticky top-0 h-screen shrink-0">
            <div class="p-6 flex items-center justify-between border-b border-slate-100">
                <div class="flex items-center gap-3 overflow-hidden">
                    <div class="bg-blue-600 p-2 rounded-lg text-white shrink-0"><i data-lucide="receipt" class="w-5 h-5"></i></div>
                    <h2 class="font-black text-slate-900 tracking-tight text-xl">DocuMint</h2>
                </div>
            </div>
           <nav class="flex-1 p-4 space-y-2 overflow-y-auto custom-scroll">
                <a href="dashboard.html" class="flex items-center gap-4 p-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-semibold transition-all group">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 shrink-0"></i>
                    <span class="sidebar-text whitespace-nowrap">Dashboard</span>
                </a>
                <a href="student.html" class="flex items-center gap-4 p-3 bg-blue-50 text-blue-600 rounded-xl font-bold transition-all group">
    <i data-lucide="users" class="w-5 h-5 shrink-0"></i>
    <span class="sidebar-text whitespace-nowrap">Students & Payments</span>
</a>
                <a href="add_fees.html" class="flex items-center gap-4 p-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-semibold transition-all group">
                    <i data-lucide="credit-card" class="w-5 h-5 shrink-0"></i>
                    <span class="sidebar-text whitespace-nowrap">Fees Management</span>
                </a>
                <a href="report.html" class="flex items-center gap-4 p-3 text-slate-500 hover:bg-slate-50 hover:text-slate-900 rounded-xl font-semibold transition-all group">
                    <i data-lucide="file-text" class="w-5 h-5 shrink-0"></i>
                    <span class="sidebar-text whitespace-nowrap">Reports</span>
                </a>
            </nav>
            <div class="mt-auto p-4 space-y-2">
    <!-- Settings Button -->
    <button onclick="window.location.href='settings.html'" class="w-full flex items-center gap-4 p-3 text-blue-400 hover:bg-blue-50 hover:text-blue-600 rounded-xl font-bold transition-all">
        <i data-lucide="settings" class="w-5 h-5 shrink-0"></i>
        <span class="sidebar-text">Settings</span>
    </button>

    <!-- Log Out Button -->
    <button onclick="window.location.href='login.html'" class="w-full flex items-center gap-4 p-3 text-red-400 hover:bg-red-50 hover:text-red-600 rounded-xl font-bold transition-all">
        <i data-lucide="log-out" class="w-5 h-5 shrink-0"></i>
        <span class="sidebar-text">Log Out</span>
    </button>
</div>
            <div class="p-4 border-t border-slate-100">
                <div class="flex items-center gap-3 p-2 bg-slate-50 rounded-xl">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center font-bold">AD</div>
                    <div class="sidebar-text">
                        <p id="current-user-name" class="text-xs font-black text-slate-900">ADMINISTRATOR</p>
                        <p class="text-[10px] text-blue-600 font-bold uppercase">Cashier Office</p>
                    </div>
                </div>
            </div>
        </aside>
        <!-- MAIN CONTENT -->
  <div class="flex-1 flex flex-col min-w-0 overflow-y-auto custom-scroll">
            <header class="h-16 bg-white border-b border-slate-200 px-8 flex items-center justify-between z-20 shrink-0">
                <div class="flex items-center gap-2">
                    <span class="text-slate-400 font-medium">Students & Payments</span>
                </div>
                
                
                <div class="flex items-center gap-4">
                      <div class="p-4 border-t border-slate-100">
                <div class="flex items-center gap-3 p-2 bg-slate-50 rounded-xl overflow-hidden">
                    <div class="w-10 h-10 bg-blue-100 text-blue-600 rounded-lg flex items-center justify-center font-bold shrink-0">AD</div>
                    <div class="sidebar-text overflow-hidden">
                        <p class="text-xs font-black text-slate-900 truncate">ADMINISTRATOR</p>
                        <p class="text-[10px] text-blue-600 font-bold uppercase truncate">System Head</p>
                    </div>
                </div>
            </div>
                  
                </div>
            </header>


            <main class="px-6 pb-6 max-w-8xl w-full mx-auto">
 
        <div class="flex-1 flex flex-col min-w-0 overflow-y-auto">
            <!-- STUDENTS TAB -->
            <div id="tab-students" class="py-4 space-y-3">
                <header class="flex justify-between items-end">
                    <div>
                        <h1 class="text-2xl font-black text-slate-900">Student Records</h1>
                        <p class="text-sm text-slate-500 font-medium">Search records and process payments</p>
                    </div>
                      <div class="flex gap-2">
                        <button onclick="toggleModal('modal-semester')" class="px-4 py-2 bg-white border border-slate-200 text-slate-700 rounded-xl text-xs font-black uppercase hover:bg-slate-50 flex items-center gap-2">
                            <i data-lucide="calendar" class="w-4 h-4"></i> Manage Semester
                        </button>
                        <button onclick="toggleModal('modal-add-student')" class="px-4 py-2 bg-slate-900 text-white rounded-xl text-xs font-black uppercase hover:bg-blue-600 flex items-center gap-2 shadow-lg shadow-slate-200 transition-all">
                            <i data-lucide="user-plus" class="w-4 h-4"></i> Add Student
                        </button>
                        <button onclick="document.getElementById('excel-upload').click()" class="px-4 py-2 bg-green-600 text-white rounded-xl text-xs font-black uppercase hover:bg-green-700 flex items-center gap-2 shadow-lg shadow-green-100 transition-all">
                            <i data-lucide="file-up" class="w-4 h-4"></i> Import Excel
                            <input type="file" id="excel-upload" class="hidden" accept=".csv, .xlsx, .xls" onchange="simulateExcelUpload(event)">
                        </button>
                    </div>
                </header>
                <!-- Search & Filters -->
                <div class="bg-white p-6 rounded-2xl border border-slate-200 shadow-sm grid grid-cols-1 md:grid-cols-4 gap-4 items-end">
                    <div class="md:col-span-2">
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">Search Student ID</label>
                        <div class="relative">
                            <i data-lucide="search" class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"></i>
                            <input id="search-id" oninput="filterStudents()" type="text" placeholder="Ex: 2025-0001" class="w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-600 outline-none transition-all">
                        </div>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">Filter Status</label>
                        <select id="filter-status" onchange="filterStudents()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold">
                            <option value="All">All Status</option>
                            <option value="Paid">Paid Only</option>
                            <option value="Unpaid">Unpaid Only</option>
                        </select>
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block">Filter College</label>
                        <select id="filter-college" onchange="filterStudents()" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl font-bold">
                            <option value="All">All Colleges</option>
                            <option value="CED">CED (Education)</option>
                            <option value="CAS">CAS (Arts & Sci)</option>
                            <option value="CBA">CBA (Business)</option>
                            <option value="CEAC">CEAC (Engineering)</option>
                            <option value="CHS">CHS (Health Sci)</option>
                        </select>
                    </div>
                </div>
                <!-- Student Table -->
                <div class="bg-white rounded-2xl border border-slate-200 overflow-hidden shadow-sm">
                    <table class="w-full text-left">
                        <thead class="bg-slate-50 border-b border-slate-200">
                            <tr class="text-[10px] text-slate-400 uppercase tracking-widest">
                                <th class="px-6 py-4">Student ID</th>
                                <th class="px-6 py-4">Full Name</th>
                                <th class="px-6 py-4">College</th>
                                <th class="px-6 py-4">Status</th>
                                <th class="px-6 py-4 text-right">Action</th>
                            </tr>
                        </thead>
                        <tbody id="student-table-body" class="divide-y divide-slate-100"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- PAYMENT / RECEIPT MODAL -->
    <div id="payment-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/50 backdrop-blur-sm">
        <div class="bg-white w-full max-w-4xl rounded-3xl shadow-2xl flex overflow-hidden max-h-[90vh]">
            <!-- Fee Selection -->
            <div class="w-1/2 p-8 border-r border-slate-100 flex flex-col">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-xl font-black text-slate-900">Process Payment</h3>
                    <button onclick="closePayment()" class="p-1 hover:bg-slate-100 rounded-full transition-colors">
                        <i data-lucide="x" class="w-5 h-5 text-slate-400"></i>
                    </button>
                </div>
                <p id="pay-student-name" class="text-blue-600 font-bold mb-6"></p>
                <div class="flex-1 space-y-4 overflow-y-auto pr-2 custom-scroll">
                    <div class="p-4 bg-slate-50 rounded-xl border border-slate-200">
                        <p class="text-[10px] font-black text-slate-400 uppercase mb-4">Select Fees to include</p>
                        <div class="space-y-3">
                            <label class="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-100 cursor-pointer hover:border-blue-300">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" class="fee-checkbox w-5 h-5 rounded text-blue-600" data-fee="Tuition Fee" data-price="15000" onchange="calculateTotal()">
                                    <span class="font-bold text-sm">Tuition Fee</span>
                                </div>
                                <span class="font-mono text-xs font-bold">15,000.00</span>
                            </label>
                            <label class="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-100 cursor-pointer hover:border-blue-300">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" class="fee-checkbox w-5 h-5 rounded text-blue-600" data-fee="Miscellaneous Fee" data-price="3500" onchange="calculateTotal()">
                                    <span class="font-bold text-sm">Miscellaneous</span>
                                </div>
                                <span class="font-mono text-xs font-bold">3,500.00</span>
                            </label>
                            <label class="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-100 cursor-pointer hover:border-blue-300">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" class="fee-checkbox w-5 h-5 rounded text-blue-600" data-fee="Laboratory Fee" data-price="2000" onchange="calculateTotal()">
                                    <span class="font-bold text-sm">Laboratory</span>
                                </div>
                                <span class="font-mono text-xs font-bold">2,000.00</span>
                            </label>
                            <label class="flex items-center justify-between p-3 bg-white rounded-lg border border-slate-100 cursor-pointer hover:border-blue-300">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" class="fee-checkbox w-5 h-5 rounded text-blue-600" data-fee="Student Activity" data-price="500" onchange="calculateTotal()">
                                    <span class="font-bold text-sm">Student Activity</span>
                                </div>
                                <span class="font-mono text-xs font-bold">500.00</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="pt-6 border-t border-slate-100 mt-6 flex items-center justify-between">
                    <div>
                        <p class="text-[10px] font-black text-slate-400 uppercase">Total Amount</p>
                        <p id="total-display" class="text-3xl font-black text-slate-900">₱0.00</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="closePayment()" class="px-6 py-3 text-sm font-bold text-slate-400 hover:text-slate-600 transition-colors">CANCEL</button>
                        <button onclick="issueAndPrint()" class="px-8 py-3 bg-blue-600 text-white font-black rounded-xl shadow-lg shadow-blue-200 hover:scale-[1.02] transition-all uppercase tracking-tight text-sm">PRINT RECEIPT</button>
                    </div>
                </div>
            </div>
            <!-- Receipt Preview -->
            <div class="w-1/2 bg-slate-50 p-8 flex flex-col">
                <!-- Receipt Preview Template (Screen Only) -->
                <div id="receipt-body-template" class="bg-white p-8 shadow-sm border border-slate-200 rounded-lg flex-1 flex flex-col">
                    <!-- Preview Header with Logo -->
                  <div class="mb-6 text-center">
    <!-- Logos side by side -->
    <div class="flex justify-center items-center gap-4 mb-2">
        <img src="assets/right-logo.jpg" alt="Left Logo" class="h-16 w-16 object-contain">
        <img src="assets/left-logo.png" alt="Right Logo" class="h-16 w-16 object-contain">
    </div>

    <!-- Centered Title and Subtitle -->
    <h4 class="text-lg font-black tracking-tighter text-blue-800">ACKNOWLEDGEMENT RECEIPT</h4>
    <p class="text-[10px] font-bold text-slate-400 uppercase">
        Notre Dame of Marbel University<br>
        Supreme Student Government<br>
        City of Koronadal South Cotabato
    </p>
</div>

                    
                    <!-- Content that is cloned for printing (DATA ONLY) -->
                    <div id="receipt-data-content" class="flex-1 flex flex-col justify-between">
                        <div class="space-y-3">
                            <div class="flex justify-between text-[10px] border-b border-slate-100 pb-2">
                                <span class="font-bold uppercase text-slate-400">Transaction ID</span>
                                <span id="rec-tid" class="font-mono font-bold">---</span>
                            </div>
                            <div class="flex justify-between text-[10px] border-b border-slate-100 pb-2">
                                <span class="font-bold uppercase text-slate-400">Date Issued</span>
                                <span id="rec-date" class="font-bold">---</span>
                            </div>
                            <div class="flex justify-between text-xs border-b border-slate-100 pb-2 pt-2">
                                <span class="font-bold uppercase text-slate-400">Paid By (Student)</span>
                                <span id="rec-student" class="font-black text-slate-900 uppercase">---</span>
                            </div>
                            
                            <div class="pt-4">
                                <p class="text-[9px] font-black text-slate-300 uppercase mb-2">Particulars</p>
                                <div id="rec-fees-list" class="space-y-1 text-xs">
                                    <p class="text-slate-400 italic">No fees selected</p>
                                </div>
                            </div>
                        </div>

                        <div class="pt-4 border-t-2 border-dashed border-slate-200">
                            <div class="flex justify-between items-center mb-10">
                                <span class="font-black text-slate-900">TOTAL AMOUNT</span>
                                <span id="rec-total" class="text-xl font-black text-blue-600">₱0.00</span>
                            </div>
                            
                            <div class="text-center">
                                <p id="rec-issuer-name" class="text-[10px] font-black text-slate-900 uppercase">ADMINISTRATOR</p>
                                <div class="w-48 border-b border-slate-900 mx-auto my-1"></div>
                                <p class="text-[8px] text-slate-400 font-bold uppercase">Authorized Issuer</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- HIDDEN CONTAINER FOR PRINTING TWO COPIES -->
    <div id="print-container" class="hidden"></div>
<div id="modal-add-student" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden border border-slate-200">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-xl font-black text-slate-900">Add New Student</h3>
                <button onclick="toggleModal('modal-add-student')" class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            <form id="form-add-student" onsubmit="handleManualAdd(event)" class="p-6 space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">Student ID</label>
                    <input type="text" name="sid" required placeholder="2025-XXXX" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">First Name</label>
                        <input type="text" name="fname" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">Last Name</label>
                        <input type="text" name="lname" required class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none focus:border-blue-500">
                    </div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">College</label>
                    <select name="college" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                        <option value="CED">CED</option>
                        <option value="CAS">CAS</option>
                        <option value="CBA">CBA</option>
                        <option value="CEAC">CEAC</option>
                        <option value="CHS">CHS</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">Initial Status</label>
                    <select name="status" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                        <option value="Unpaid">Unpaid</option>
                        <option value="Paid">Paid</option>
                    </select>
                </div>
                <button type="submit" class="w-full py-4 bg-blue-600 text-white font-black uppercase tracking-widest text-xs rounded-xl hover:bg-blue-700 transition-all shadow-lg shadow-blue-100">Save Record</button>
            </form>
        </div>
    </div>


    <!-- MODAL: MANAGE SEMESTER -->
    <div id="modal-semester" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-slate-900/40 backdrop-blur-sm p-4">
        <div class="bg-white w-full max-w-sm rounded-3xl shadow-2xl overflow-hidden border border-slate-200">
            <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                <h3 class="text-xl font-black text-slate-900">Manage Semester</h3>
                <button onclick="toggleModal('modal-semester')" class="text-slate-400 hover:text-slate-600"><i data-lucide="x"></i></button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">Academic Year</label>
                    <input type="text" id="input-ay" placeholder="e.g. 2024-2025" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">Active Semester</label>
                    <select id="input-sem" class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl outline-none">
                        <option value="1st Semester">1st Semester</option>
                        <option value="2nd Semester">2nd Semester</option>
                        <option value="Summer">Summer</option>
                    </select>
                </div>
                <button onclick="updateSemester()" class="w-full py-4 bg-slate-900 text-white font-black uppercase tracking-widest text-xs rounded-xl hover:bg-slate-800 transition-all">Update Term</button>
            </div>
        </div>
    </div>

    <script>
        let studentDb = [];
        let activeStudent = null;
        const COLLEGES = ['CED', 'CAS', 'CBA', 'CEAC', 'CHS'];
        const NAMES = ['Aldrin Santos', 'Beatriz Cruz', 'Charlie Mendoza', 'Diana Ross', 'Ethan Hunt', 'Fiona Gallagher', 'George Miller', 'Hannah Abbott', 'Ivan Drago', 'Julia Roberts', 'Kevin Hart', 'Lana Del Rey', 'Mike Tyson', 'Nina Simone', 'Oscar Isaac', 'Peter Parker', 'Quinn Fabray', 'Rachel Green', 'Steve Rogers', 'Tony Stark'];
        
        function initData() {
            for(let i=1; i<=60; i++) {
                studentDb.push({
                    id: `2025-${String(i).padStart(4, '0')}`,
                    name: NAMES[i % NAMES.length] + (i > 20 ? ` ${i}` : ''),
                    college: COLLEGES[i % COLLEGES.length],
                    status: Math.random() > 0.5 ? 'Paid' : 'Unpaid'
                });
            }
        }
        
        
        function filterStudents() {
            const search = document.getElementById('search-id').value.toLowerCase();
            const status = document.getElementById('filter-status').value;
            const college = document.getElementById('filter-college').value;
            const filtered = studentDb.filter(s => {
                const matchesSearch = s.id.toLowerCase().includes(search) || s.name.toLowerCase().includes(search);
                const matchesStatus = status === 'All' || s.status === status;
                const matchesCollege = college === 'All' || s.college === college;
                return matchesSearch && matchesStatus && matchesCollege;
            });
            renderStudents(filtered);
        }
        
        function renderStudents(data) {
            const tbody = document.getElementById('student-table-body');
            tbody.innerHTML = '';
            
            data.forEach(s => {
                const statusColor = s.status === 'Paid' ? 'text-green-600 bg-green-50' : 'text-red-500 bg-red-50';
                tbody.innerHTML += `
                    <tr class="hover:bg-slate-50/50 transition-colors">
                        <td class="px-6 py-4 font-mono text-xs font-bold text-blue-600">${s.id}</td>
                        <td class="px-6 py-4 font-bold text-slate-800">${s.name}</td>
                        <td class="px-6 py-4 text-xs font-bold text-slate-500 uppercase">${s.college}</td>
                        <td class="px-6 py-4">
                            <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase ${statusColor}">${s.status}</span>
                        </td>
                        <td class="px-6 py-4 text-right">
                            <button onclick="openPayment('${s.id}')" class="px-4 py-2 bg-slate-900 text-white text-[10px] font-black uppercase rounded-lg hover:bg-blue-600 transition-all">Process</button>
                        </td>
                    </tr>
                `;
            });
            if(data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="py-20 text-center text-slate-400 italic">No records found matching your filters</td></tr>`;
            }
        }
        
        function openPayment(id) {
            activeStudent = studentDb.find(s => s.id === id);
            document.getElementById('pay-student-name').innerText = `${activeStudent.name} (${activeStudent.id})`;
            document.getElementById('rec-student').innerText = activeStudent.name;
            
            const issuerName = document.getElementById('current-user-name').innerText;
            document.getElementById('rec-issuer-name').innerText = issuerName;
            
            // Reset checkboxes and total
            document.querySelectorAll('.fee-checkbox').forEach(cb => cb.checked = false);
            calculateTotal();
            
            document.getElementById('payment-modal').classList.remove('hidden');
        }
        
        function closePayment() {
            document.getElementById('payment-modal').classList.add('hidden');
            activeStudent = null;
        }
        
        function calculateTotal() {
            let total = 0;
            const selectedList = document.getElementById('rec-fees-list');
            selectedList.innerHTML = '';
            
            document.querySelectorAll('.fee-checkbox:checked').forEach(cb => {
                const fee = cb.getAttribute('data-fee');
                const price = parseFloat(cb.getAttribute('data-price'));
                total += price;
                selectedList.innerHTML += `
                    <div class="flex justify-between items-center text-slate-600">
                        <span>• ${fee}</span>
                        <span class="font-mono">₱${price.toLocaleString()}</span>
                    </div>
                `;
            });
            
            if(total === 0) selectedList.innerHTML = '<p class="text-slate-400 italic">No fees selected</p>';
            
            const formattedTotal = `₱${total.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('total-display').innerText = formattedTotal;
            document.getElementById('rec-total').innerText = formattedTotal;
        }
        
        function issueAndPrint() {
            const totalText = document.getElementById('total-display').innerText;
            const total = parseFloat(totalText.replace(/[₱,]/g, ''));
            
            if(total === 0) {
                console.error("Cannot issue receipt: Total amount is zero. Please select fees.");
                // In a real application, display a user-friendly modal error here
                return;
            }
            
            // 1. Update active student status (in-memory simulation)
            if (activeStudent) {
                activeStudent.status = 'Paid';
            }

            // 2. Generate transaction details and update preview
            document.getElementById('rec-tid').innerText = 'TXN-' + Math.random().toString(36).substr(2, 9).toUpperCase();
            document.getElementById('rec-date').innerText = new Date().toLocaleDateString('en-US', {
                year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
            });

            // 3. Get the content of the receipt DATA ONLY section
            const receiptDataContent = document.getElementById('receipt-data-content').innerHTML;
            
            // Logo URL for the placeholder
            const logoUrl = "https://placehold.co/80x80/2563eb/ffffff?text=U+Logo";

            // 4. Build the single print HTML structure (Student Copy)
            const singleReceiptHtml = `
                <div class="receipt-copy">
                    <!-- Header with centered logo and title -->
                  <div class="text-center mb-6">
    <!-- Logos side by side -->
    <div style="display: flex; justify-content: center; gap: 8px; margin-bottom: 8px;">
        <img src="right-logo.jpg" alt="Left Logo" style="height: 50px; width: 50px; object-fit: contain;">
        <img src="left-logo.png" alt="Right Logo" style="height: 50px; width: 50px; object-fit: contain;">
    </div>

    <!-- Centered Title and Subtitle -->
    <h4 class="text-lg font-black tracking-tighter text-blue-800" style="color: #1e293b !important; margin: 0;">
        ACKNOWLEDGEMENT RECEIPT
    </h4>
    <p class="text-[10px] font-bold text-slate-400 uppercase" style="margin: 0;">
         Notre Dame of Marbel University<br>
        Supreme Student Government<br>
        City of Koronadal South Cotabato

    </p>
</div>

                    
                    <!-- Receipt content (cloned from the modal preview data) -->
                    ${receiptDataContent}
                </div>
            `;
            
            // 5. Wrap the single copy in a layout container for a single page print
            const printContainer = document.getElementById('print-container');
            printContainer.innerHTML = `
                <div class="print-page-layout">
                    ${singleReceiptHtml}
                </div>
            `;
            
            // 6. Apply print class to body and refresh UI
            document.body.classList.add('printing');
            filterStudents(); // Update table row status

            // 7. Trigger print and clean up
            setTimeout(() => {
                window.print();
                
                // Clean up after print dialog is initiated
                setTimeout(() => {
                    document.body.classList.remove('printing');
                    printContainer.innerHTML = '';
                    closePayment();
                }, 500); 

            }, 100);
        }
        
        window.onload = () => {
            initData();
            filterStudents();
            lucide.createIcons();
        };
        function toggleModal(id) {
    const modal = document.getElementById(id);
    modal.classList.toggle('hidden'); // Adds/removes the 'hidden' class
}

    </script>
</body>
</html>